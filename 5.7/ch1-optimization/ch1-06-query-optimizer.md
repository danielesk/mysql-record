# 6.1 控制查询优化器

MySQL通过影响查询计划评估方式的系统变量，可切换优化，优化器和索引提示以及优化器成本模型来提供优化器控制。

## 6.1.1 控制查询计划评估

查询优化器的任务是找到执行SQL查询的最佳计划。因为“好”和“差”计划之间的性能差异可能是数量级（即秒与小时甚至数天），所以大多数查询优化器（包括MySQL的查询优化器）执行或多或少的详尽搜索以获得最佳计划所有可能的查询评估计划。对于连接查询，MySQL优化器调查的可能计划数量随着查询中引用的表的数量呈指数增长。对于少量表（通常小于7到10），这不是问题。但是，当提交较大的查询时，在查询优化中花费的时间可能很容易成为服务器性能的主要瓶颈。

更灵活的查询优化方法使用户能够控制优化器在搜索最佳查询评估计划时的详尽程度。一般的想法是，优化器调查的计划越少，编译查询所花费的时间就越少。另一方面，由于优化器会跳过某些计划，因此可能无法找到最佳计划。

可以使用两个系统变量来控制优化程序相对于其计算的计划数量的行为：

`optimizer_prune_level`变量告诉优化器根据对每个表访问的行数的估计跳过某些计划。我们的经验表明，这种“有根据的猜测”很少会错过最佳计划，并且可能会大大缩短查询编译时间。这就是默认情况下此选项打开（optimizer_prune_level = 1）的原因。但是，如果您认为优化程序错过了更好的查询计划，则可以关闭此选项（`optimizer_prune_level = 0`），但存在查询编译可能需要更长时间的风险。请注意，即使使用此启发式算法，优化程序仍会探索大致指数的计划。





















































